# Habit Tracker API

## Описание проекта

**Habit Tracker API** — это серверная часть приложения для отслеживания привычек. Пользователи могут добавлять свои
привычки, устанавливать время выполнения, получать напоминания через Telegram и отслеживать свои достижения. Приложение
реализовано в соответствии с принципами REST API.

---

## Функционал

### Основные возможности

- **Регистрация и авторизация пользователей** с использованием JWT-токенов.
- **CRUD для привычек**:
    - Создание, редактирование, удаление и просмотр привычек.
- **Публичные привычки**:
    - Просмотр привычек, отмеченных как публичные, другими пользователями.
- **Напоминания в Telegram**:
    - Уведомления о запланированных привычках через Telegram.
- **Пагинация**:
    - Списки привычек отображаются с ограничением 5 записей на страницу.
- **Отложенные задачи с Celery**:
    - Задачи для рассылки напоминаний настроены через Celery и `django-celery-beat`.

---

## Установка и настройка с Docker

### Требования

- Установленный **Docker** и **Docker Compose**.

### Инструкция по установке

1. Склонируйте репозиторий:
    ```bash
    git clone <https://github.com/DKI62/cw7>
    cd cw7
    ```

2. Создайте файл `.env` в корне проекта и добавьте в него настройки для базы данных и Telegram-бота:
    ```.env.example
   SECRET_KEY=
   
   REDIS_URL=
   CELERY_BROKER_URL=
   
   TELEGRAM_BOT_TOKEN=
   
   #db
   POSTGRES_DB=
   POSTGRES_USER=
   POSTGRES_PASSWORD=
   POSTGRES_HOST=
   POSTGRES_PORT=
    ```

3. Запустите контейнеры с помощью Docker Compose:
    ```bash
    docker-compose up --build -d
    ```

    Эта команда соберет и запустит контейнеры для Django, PostgreSQL, Redis, Celery и Telegram-бота.

4. Создайте суперпользователя:
    ```bash
    docker-compose exec django_app python manage.py createsuperuser
    ```

    Следуйте инструкциям для создания суперпользователя.

5. Для запуска Celery, откройте еще два терминала и выполните команды:
    - Для рабочего процесса Celery:
      ```bash
      docker-compose exec celery_worker celery -A config worker --loglevel=info
      ```
    - Для планировщика Celery:
      ```bash
      docker-compose exec celery_beat celery -A config beat --loglevel=info
      ```

### Доступ к приложению

- **Django Admin** доступен по адресу: `http://localhost:8000/admin/`
- **API** доступно по адресу: `http://localhost:8000/api/`
- **Документация API** доступна по адресу:
  - Swagger: `http://localhost:8000/api/docs/swagger/`
  - Redoc: `http://localhost:8000/api/docs/redoc/`

---

## Использование

### Эндпоинты API

1. **Регистрация**:
    - `POST /api/users/register/`
    - Пример запроса:
      ```json
      {
          "username": "user",
          "password": "password",
          "email": "user@example.com"
      }
      ```

2. **Авторизация**:
    - `POST /api/token/` — получение JWT-токенов.
    - `POST /api/token/refresh/` — обновление токенов.

3. **Привычки**:
    - `GET /api/habits/` — список привычек текущего пользователя (с пагинацией), список публичных привычек для всех, в том числе неавторизованным пользователям.
    - `POST /api/habits/` — создание новой привычки.
    - `GET /api/habits/{id}/` — получение подробной информации о привычке.
    - `PUT /api/habits/{id}/` — обновление привычки.
    - `PATCH /api/habits/{id}/` — частичное обновление привычки.
    - `DELETE /api/habits/{id}/` — удаление привычки.

---

## Особенности реализации

1. **Валидаторы**:
    - Проверка совместимости связанных привычек и вознаграждений.
    - Ограничение времени выполнения привычки до 120 секунд.
    - Проверка периодичности выполнения привычек.

2. **Интеграция с Telegram**:
    - Уведомления пользователям о привычках с помощью Telegram-бота.

3. **Тестирование**:
    - Покрытие тестами более 80%.
    - Использованы `pytest` и `pytest-django`.

4. **Пагинация**:
    - Реализована пагинация для списков привычек (по 5 записей на страницу).

---

## Зависимости

- Django
- Django REST Framework
- Celery
- django-celery-beat
- django-cors-headers
- redis
- drf-spectacular
- python-telegram-bot

---

## Документация API

Документация автоматически генерируется и доступна по адресу:

/api/docs/swagger/ & /api/docs/redoc/

Для визуального просмотра используйте Swagger UI.

---

## Разработка

1. **Код соответствует PEP-8**:
   - Проведена проверка `flake8`.
   - Результат: 100% при исключении миграций.

2. **Проект готов к развёртыванию**:
   - Используются переменные окружения.
   - Настроены зависимости в `poetry.lock` & 'requirements.txt'.

3. **Работа с асинхронностью**:
   - Использованы Celery и Telegram API для асинхронной отправки сообщений.

---

## Развертывание на удаленном сервере

1. Установите Docker и Docker Compose на сервер.
2. Клонируйте репозиторий на сервер.
3. Создайте и настройте файл `.env` на сервере.
4. Запустите контейнеры с помощью команды:

```bash
docker-compose up --build -d
```
---
-Проект будет запущен на удаленном сервере.-
---

      Разработано в рамках учебного проекта.
      Используются Django, Celery, Redis, PostgreSQL и Telegram Bot API.


В этом `README.md` добавлена информация о настройке Docker, о том, как собрать и запустить проект с помощью Docker Compose, а также краткое описание функционала и структуры API.
